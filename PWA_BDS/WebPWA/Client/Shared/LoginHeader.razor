@inject NavigationManager NavigationManager
@using WebPWA.Shared
@inject Blazored.LocalStorage.ILocalStorageService localStorage

@if (isLogin)
{
    <div class="top-row px-4">
        <h4><b>Hello @fullName</b></h4>
        <button class="btn btn-danger" @onclick="LogoutUser">Logout</button>
    </div>
}
else
{
    <div class="top-row px-4">
        <button class="btn btn-danger" @onclick="LoginUser">Login</button>
    </div>
}

@code {
    UserLogin currentUser = new UserLogin();
    string key = "userInfo";
    string fullName;
    bool isLogin = false;

    protected override async Task OnInitializedAsync()
    {
        currentUser = await localStorage.GetItemAsync<UserLogin>(key);
        if (currentUser != null)
        {
            isLogin = true;
            fullName = currentUser.LoginName;
        }
    }

    private void LoginUser()
    {
        NavigationManager.NavigateTo("user/login", true);
    }

    private void LogoutUser()
    {
        ClearLocalStorage();
        NavigationManager.NavigateTo("/", true);
    }

    public async void ClearLocalStorage()
    {
        await localStorage.ClearAsync();
    }
}
